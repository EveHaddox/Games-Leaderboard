<!-- admin.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin Panel – Game Tracker</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body data-page="admin">
  <h1>Admin Panel</h1>

  <!-- If not logged in, show this -->
  <div id="not-logged-in">
    <p>To add new games, please log in with GitHub so we can commit to the repo.</p>
    <button id="login-button">Login with GitHub</button>
    <p><a href="index.html">← Back to Leaderboard</a></p>
  </div>

  <!-- Once logged in, show the form -->
  <div id="game-form-container" style="display: none;">
    <p>Logged in as <strong id="admin-username"></strong> <button id="logout-button">Logout</button></p>

    <form id="add-game-form">
      <div class="form-group">
        <label for="gameName"><strong>Game Name</strong><br />
          <input type="text" id="gameName" placeholder="e.g. Company of Heroes 2" required />
        </label>
      </div>

      <div class="form-group">
        <label for="teams"><strong>Teams (one line per team; players separated by commas)</strong><br />
          <textarea id="teams" rows="4" placeholder="team 1: alice, bob, charlie&#10;team 2: david, eve" required></textarea>
        </label>
      </div>

      <div class="form-group">
        <label for="winningTeam"><strong>Winning Team (0 = first line, 1 = second line, etc.)</strong><br />
          <select id="winningTeam" required>
            <option value="0">Team 1</option>
            <option value="1">Team 2</option>
            <!-- JS can add more options dynamically if we want >2 teams, but for simplicity, let the admin manually edit index if >2 teams -->
          </select>
        </label>
        <small>If you have more than two teams, type the correct index here (e.g. “2” for third line).</small>
      </div>

      <input type="submit" value="Add Game" />
    </form>

    <p><a href="index.html">← Back to Leaderboard</a></p>
    <div id="admin-error" class="error"></div>
  </div>

  <script>
    // A tiny bit of inline JS just to show the GitHub username (optional).
    // Once logged in, we can call “GET https://api.github.com/user” to fetch the username.
    async function displayAdminUsername() {
      const token = localStorage.getItem("github_access_token");
      if (!token) return;
      try {
        const res = await fetch("https://api.github.com/user", {
          headers: {
            Authorization: `Bearer ${token}`,
            Accept: "application/vnd.github.v3+json"
          }
        });
        if (!res.ok) throw new Error("Failed to fetch user");
        const { login } = await res.json();
        document.getElementById("admin-username").innerText = login;
      } catch (err) {
        console.warn("Could not fetch username:", err);
      }
    }

    // Call it when admin is logged in
    document.addEventListener("DOMContentLoaded", () => {
      const token = localStorage.getItem("github_access_token");
      if (token) displayAdminUsername();
    });
  </script>
  <script src="scripts.js"></script>
</body>
</html>
